---
sidebar: sidebar 
permalink: lifecycle/sc-copy-clone-overview-sys-refresh-wf-sc.html 
keywords: tr4667, 4667, SAP HANA, cloning, system refresh 
summary: SAPのライフサイクル管理を最適化するNetAppソリューションは、SAP HANAデータベースとライフサイクル管理ツールに統合されており、効率的なアプリケーション統合データプロテクションと、SAPテストシステムの柔軟なプロビジョニングが組み合わされています。 
---
= SnapCenter を使用したSAPシステムの更新ワークフローの概要
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
SnapCenterには、既存のSnapshotバックアップからデータセットのクローンを管理するワークフローが用意されています。このクローンデータセットはFlexCloneボリュームで、ソースシステムからHANAデータボリュームを迅速にプロビジョニングしてターゲットシステムに接続するために使用できます。したがって、QA、テスト、サンドボックス、またはトレーニングシステムのシステム更新処理を実行する場合に最適です。

SnapCenter クローニングワークフローは、ストレージレイヤで必要なすべての処理を処理します。また、スクリプトを使用して拡張し、ホスト固有の処理とHANAデータベース固有の処理を実行することもできます。本ドキュメントでは、スクリプトを使用して、HANAデータベースのリカバリ処理とシャットダウン処理を実行します。SnapCenter ワークフローにスクリプトを使用してさらに自動化を進めることで、必要なHANAデータベースの処理はすべて処理されますが、SAPの後処理の手順については説明しません。SAPの後処理は、手動またはサードパーティのツールを使用して実行する必要があります。

SnapCenterを使用したSAPシステムの更新ワークフローは、次の図に示すように、主に5つの手順で構成されます。

. ターゲットシステムの初回インストールと準備
+
.. 新しいターゲットシステムにSnapCenter HANAプラグインをインストールし、SnapCenterでHANAシステムを設定する必要があります。
.. ターゲットシステムを停止し、HANAデータボリュームをアンマウントする必要があります。


. SnapCenterクローン作成ワークフロー
+
.. SnapCenterがソースシステムの選択したSnapshotのFlexCloneボリュームを作成
.. SnapCenterがターゲットシステムにFlexCloneボリュームをマウントする
.. ターゲットのHANAデータベースのリカバリは、スクリプトをポストスクリプトとして使用して自動化することも、手動で実行することもできます `sc-system-refresh` 。


. SAPの後処理（手動またはサードパーティのツールを使用）
. これで、システムをテスト/QAシステムとして使用できるようになります。
. 新しいシステム更新が要求されると、SnapCenterクローン削除ワークフローを使用してFlexCloneボリュームが削除されます。
+
.. ターゲットのHANAシステムがSnapCenterで保護されている場合は、クローン削除ワークフローを開始する前に保護を削除する必要があります。
.. HANAシステムは手動で停止するか、SnapCenterのプリスクリプトとしてスクリプトを使用して自動的に停止する必要があります。 `sc-system-refresh`
.. SnapCenterがHANAデータボリュームをアンマウントする
.. SnapCenterがFlexCloneボリュームを削除
.. ステップ2でリフレッシュが再開されます。




image:sc-copy-clone-image7.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

ほとんどの場合、ターゲットテスト/QAシステムは少なくとも数週間使用されます。FlexCloneボリュームがソースシステムボリュームのSnapshotをブロックしているため、このSnapshotには、ソースシステムボリュームでのブロック変更率に基づいて追加の容量が必要になります。本番ソースシステムで1日あたりの平均変更率が20%の場合、ブロックされたSnapshotは5日後に100%に達します。そのため、NetAppでは、クローンが本番用のソースシステムに基づいている場合は、FlexCloneボリュームをすぐにスプリットするか、数日後にスプリットすることを推奨しています。クローンスプリット処理ではクローンボリュームの使用はブロックされないため、HANAデータベースの使用中にいつでも実行できます。


NOTE: FlexCloneボリュームをスプリットすると、SnapCenter はターゲットシステムに作成されたすべてのバックアップを削除します。


NOTE: SnapCenterおよびAzure NetApp FilesでAzure NetApp Filesは、作成後に常にクローンがスプリットされるため、クローンスプリット処理は実行できません。

クローンスプリットを含む更新処理は、次の手順で構成されます。

. ターゲットシステムの初回インストールと準備
+
.. 新しいターゲットシステムにSnapCenter HANAプラグインをインストールし、SnapCenterでHANAシステムを設定する必要があります。
.. ターゲットシステムを停止し、HANAデータボリュームをアンマウントする必要があります。


. SnapCenterクローン作成ワークフロー
+
.. SnapCenterがソースシステムの選択したSnapshotのFlexCloneボリュームを作成
.. SnapCenterがターゲットシステムにFlexCloneボリュームをマウントする
.. ターゲットのHANAデータベースのリカバリは、スクリプトをポストスクリプトとして使用して自動化することも、手動で実行することもできます `sc-system-refresh` 。


. SnapCenterクローンスプリットワークフローを使用してFlexCloneボリュームをスプリットします。
. SAPの後処理（手動またはサードパーティのツールを使用）
. これで、システムをテスト/QAシステムとして使用できるようになります。
. 新しいシステムの更新が要求されると、クリーンアップは次の手動手順で実行されます。
+
.. ターゲットのHANAシステムがSnapCenterで保護されている場合は、保護を削除する必要があります。
.. HANAシステムを手動で停止する必要がある
.. HANAデータボリュームをアンマウントし、SnapCenterからfstabエントリを削除する（手動タスク）
.. ステップ2でリフレッシュが再開されます。
+

NOTE: 以前にスプリットされていた古いデータボリュームは、ストレージシステムで手動で削除する必要があります。





image:sc-copy-clone-image8.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

このセクションではlink:sc-copy-clone-hana-sys-refresh-with-sc.html["「SnapCenter でSAP HANAシステムを更新」"]、両方のシステム更新ワークフローについて、詳細なステップバイステップで説明します。
