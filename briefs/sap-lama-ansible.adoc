---
sidebar: sidebar 
permalink: briefs/sap-lama-ansible.html 
keywords: sb-4292, pdf, sap, hana, provisioning, lifecycle, management, automation, LaMa, landscape 
summary: 本ドキュメントでは、NetApp®ストレージシステムをオンプレミス、パブリッククラウドインフラサービス（IaaS）環境、ハイブリッドクラウドのいずれで運用している場合でも、Ansible Playbookとカスタムスクリプトを使用して、SAP Landscape Management（LaMa）に統合する方法について説明します。 
---
= SB-4292：AnsibleによるSAP自動化
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


[role="lead"]
本ドキュメントでは、NetApp®ストレージシステムをオンプレミス、パブリッククラウドインフラサービス（IaaS）環境、ハイブリッドクラウドのいずれで運用している場合でも、Ansible Playbookとカスタムスクリプトを使用して、SAP Landscape Management（LaMa）に統合する方法について説明します。



== 解決策の概要

SAPシステムは非常に複雑です。しかし、SAPを使用している企業では、これらのシステムがビジネスプロセスの中心となっています。SAPシステム管理者は、日常的な運用タスクを自動化することで、より多くのシステムをより少ない労力で管理し、再現可能な結果を生み出し、人為的ミスを減らすことができます。

本ドキュメントでは、NetApp®ストレージシステムをオンプレミス、パブリッククラウドインフラサービス（IaaS）環境、ハイブリッドクラウドのいずれで運用している場合でも、Ansible Playbookとカスタムスクリプトを使用して、SAP Landscape Management（LaMa）に統合する方法について説明します。この統合により、SAP管理者は、NetApp Snapshot™およびNetApp FlexClone®テクノロジを使用して、SAPシステムの更新タスクを高速化できます。



=== 対象者

本ドキュメントは、Ansibleの自動化にあまり経験がない（またはまったく経験がない）SAPシステム管理者を対象としています。Ansibleの使用を開始し、最初のプレイブックを実行し、SAP LaMaベースの最初のシステム更新処理を設定して実行するのに役立ちます。



=== SAPシステムのクローニング、コピー、更新のシナリオ

SAPシステムのコピーは、SAPシステムのクローニング、SAPシステムのコピー、SAPシステムの更新という3つのプロセスの同義語としてよく使用されます。ワークフローとユースケースが異なるため、処理を区別することが重要です。

* * SAPシステムのクローン*。SAPシステムクローンは、ソースSAPシステムの同一のクローンです。SAPシステムクローンは、一般に論理的な破損に対処したり、ディザスタリカバリのシナリオをテストしたりするのに使用されます。システムのクローニング処理では、ホスト名、インスタンス番号、およびSecure Identifier（SID；セキュア識別子）は同じままです。そのため、本番環境と通信できないように、ターゲットシステムの適切なネットワークフェンシングを設定することが重要です。
* * SAPシステムのコピー*。SAPシステムのコピーは、ソースSAPシステムのデータを使用して新しいターゲットSAPシステムをセットアップすることです。たとえば、本番システムのデータを含む追加のテストシステムを新しいターゲットシステムにすることができます。ソース・システムとターゲット・システムでは、ホスト名、インスタンス番号、およびSIDが異なります。
* * SAPシステムの更新*。SAPシステムの更新とは、既存のターゲットSAPシステムをソースSAPシステムのデータで更新することです。ターゲットシステムは通常、品質管理システムなどのSAPトランスポート環境の一部であり、本番用システムのデータで更新されます。ソース・システムとターゲット・システムでは、ホスト名、インスタンス番号、およびSIDが異なります。


次の図はNetApp、SAPシステムのLaMaストレージに関連するクローニング、コピー、更新の各ワークフローの手順を示しています。

image::sap-lama-image1.png[NetAppstorageに関連するSAPシステムのLaMaのクローニング、コピー、更新の各ワークフロー手順を示す図]



=== 解決策テクノロジ

ソリューション全体は、次の主要コンポーネントで構成されています。

* SAP LaMaシステム
* NetAppストレージシステム
* SAPホストエージェントがインストールされたAnsibleコントロールノード。Red Hat Ansible Automation Platformを使用することを推奨します。Red Hat Ansible Automation Platformには次のようなメリットがあります。
+
** AIを使用して自動化タスクに関するコードの推奨事項を生成
** イベントドリブンな自動化で手動タスクを削減
** 定義され、一貫性があり、移植性が高い
** 環境全体で自動化を拡張
** 事前パッケージ化されたコンテンツで自動化を加速
** 豊富なレポート機能とオブザーバビリティ指標による自動化の追跡と管理
** タスク、モジュール、プレイブックの作成




次の図は、SAPホストエージェントから実行されたシェルスクリプトによってトリガーされる、SAP LaMaストレージシステムとNetAppストレージシステムが、専用のAnsibleホスト上のAnsible Playbookを介してどのように統合されるかを示しています。

image::sap-lama-image2.png[SAP LaMaストレージシステムとNetAppストレージシステムが、専用のAnsibleホスト上のAnsible Playbookを介して統合される様子を示す画像。SAPホストエージェントから実行されたシェルスクリプトによってトリガーされます。]



=== ユースケースの概要

テストやトレーニングを目的として、ソースシステムのデータをターゲットシステムで利用できるようにする必要があるシナリオはいくつかあります。これらのテストシステムとトレーニングシステムは、ソースシステムのデータで定期的に更新して、テストとトレーニングが最新のデータセットで確実に実行されるようにする必要があります。このようなシステム更新処理は、インフラ、データベース、アプリケーションの各レイヤでの複数のタスクで構成され、自動化のレベルによっては数日かかることがあります。

インフラレイヤとデータベースレイヤで必要なタスクを高速化、自動化するには、SAP LaMaとNetAppのクローニングワークフローを使用します。SAP LaMaでは、ソースシステムからターゲットシステムにバックアップをリストアする代わりに、NetApp SnapshotとFlexCloneテクノロジを使用しているため、次の図に示すように、データベースを起動するために必要なタスクを数時間ではなく数分で実行できます。クローニングプロセスに要する時間はデータベースのサイズに左右されないため、非常に大規模なシステムでも数分で作成できます。オペレーティングシステムとデータベースレイヤ、およびSAPのポストプロセス側のタスクを自動化することで、実行時間をさらに短縮できます。

次の図は、自動化を使用すると運用効率が向上する可能性があることを示しています。

image::sap-lama-image3.png[自動化を使用すると運用効率が向上する可能性があることを示す画像]



=== さまざまなテクノロジコンポーネントの統合

Ansibleを使用してSAP LaMaをNetAppストレージシステムと統合するには、Ansible Playbookを実行できるノードが必要です。Ansible Automation Platformの使用を推奨します。SAP LaMaから起動したこのホストでシェルスクリプトとAnsible Playbookを実行するには、このサーバでSAPホストエージェントを実行する必要があります。SAP Host AgentはSAP LaMaとの双方向通信を引き継ぎ、実際のプレイブックをトリガーするシェルスクリプトを実行します。

この疎結合アーキテクチャにより、SAP LaMaだけでなく、SAP LaMa外からもワークフローを自由に開始できます。プレイブックと対応するロジックは1回だけ設定する必要があり、さまざまなシナリオやユースケースで使用できます。



== まとめ

NetApp、SAP LaMa、Ansible自動化プラットフォームを組み合わせることで、SAPシステム管理に関連する最も複雑で時間のかかるタスクに必要な時間と労力を大幅に削減できる強力なソリューションを提供します。また、この組み合わせは、人為的ミスがシステム間で引き起こす構成のずれを回避するのにも役立ちます。

システムの更新、コピー、クローン、ディザスタリカバリのテストは非常に機密性の高い手順であるため、このようなソリューションを実装すると、貴重な管理時間を節約できます。また、SAPシステム管理者に対する組織の他の組織の信頼を強化することもできます。テストなどの目的でシステムをコピーするのがどれだけ簡単か、トラブルシューティングにかかる時間をどれだけ節約できるかがわかります。



== 追加情報の参照先

このドキュメントに記載されている情報の詳細については、以下のドキュメントや Web サイトを参照してください。

* link:https://github.com/sap-linuxlab/demo.netapp_ontap/blob/main/netapp_ontap.md["NetApp ONTAP®向けAnsible Playbookを使用した運用の自動化"]
* link:https://netapp.io/2018/10/08/getting-started-with-netapp-and-ansible-install-ansible/["NetApp固有のAnsibleドキュメント"]
* link:https://docs.ansible.com/ansible/latest/collections/netapp/ontap/index.html["NetApp ONTAP Ansibleモジュールと完全なドキュメント"]
* link:https://www.redhat.com/en/technologies/management/ansible/features["Red Hat Ansible自動化プラットフォーム"]




== バージョン履歴

[cols="25,25,50"]
|===
| バージョン | 日付 | 概要を更新します 


| バージョン0.1 | 03.2023 | 第1稿。 


| バージョン0.2 | 01.2024 | 見直しと若干の修正 


| バージョン0.3 | 06.2024 | HTML形式に変換 
|===