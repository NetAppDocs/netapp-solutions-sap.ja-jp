---
sidebar: sidebar 
permalink: backup/anf-cba-file-based-backup-operations-of-the-hana-database.html 
keywords: assign policy, file-based backup, cba topology, sap hana studio 
summary: このセクションでは、HANAデータベースのファイルベースのバックアップ処理を完了する方法について説明します。 
---
= HANAデータベースのファイルベースのバックアップ処理
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


link:anf-cba-snapshot-based-backup-operations-of-the-hana-database.html["以前：HANAデータベースのSnapshotベースのバックアップ処理。"]

[role="lead"]
SAP では、ブロックの整合性チェックを実行するために、ストレージベースの Snapshot バックアップと週次ファイルベースのバックアップを組み合わせることを推奨しています。Cloud Backup for Applicationsでは、バックアップタイプとしてファイルベースのバックアップが選択されているポリシーを使用して、ブロック整合性チェックを実行できます。

ファイルベースのバックアップでは、HANAデータボリュームのSnapshotバックアップに加えて、セカンダリバックアップコピーも作成されます。これらのファイルベースのバックアップは、プライマリデータボリュームが完全に失われた場合のリストア処理とリカバリ処理に使用できます。

このポリシーを使用してバックアップをスケジュールすると、Cloud Backup for Applicationsによって、システムおよびすべてのテナントデータベース用に標準のSAP HANAファイルバックアップが作成されます。



== HANAシステムにポリシーを割り当てます

スケジュールされたバックアップをアクティブ化するには、HANAシステムにバックアップポリシーを割り当てる必要があります。

. [ポリシーの割り当て]*>*[データボリューム]*に移動します。
+
image:anf-cba-image48.png["完了している手順のスクリーンショット。"]

. ファイルベースのバックアップのポリシーを選択し、*[割り当て]*をクリックします。
+
image:anf-cba-image49.png["完了している手順のスクリーンショット。"]

. これでポリシーがHANAシステムに割り当てられ、スケジュール定義に基づいてファイルベースのバックアップが実行されます。




== ファイルベースのバックアップをオンデマンドで作成

オンデマンドデータベースバックアップを作成するには、次の手順を実行します。

. CBAダッシュボードビューで、コンテキストメニューから[On-Demand Backup–Data Volume]を選択します。
+
image:anf-cba-image50.png["完了している手順のスクリーンショット。"]

. [オンデマンドバックアップ]ダイアログで、*[ポリシーベース]*または*[ 1回のみ]*を選択します。
+
** Policy-Based *では、オンデマンドバックアップは、保持およびプリスクリプトおよびポストスクリプトの設定に関して、スケジュールされたバックアップと同様に処理されます。
** One time *では、特定の保持、特定のバックアップ名、特定のプリスクリプトとポストスクリプトを定義できます。


. この例では、ポリシーベースを選択しています。次の手順でポリシーと保持を選択します。
+
image:anf-cba-image51.png["完了している手順のスクリーンショット。"]

. [Job Monitoring]ビューでは、さまざまなワークフローステップ、ステップの実行時間、および合計操作実行時間を確認できます。
+
image:anf-cba-image52.png["完了している手順のスクリーンショット。"]

+
image:anf-cba-image53.png["完了している手順のスクリーンショット。"]





== CBAトポロジビューでファイルベースのバックアップ情報を確認します

Cloud Backup for Applicationsでは、Snapshotコピーベースのバックアップと同様にファイルベースのバックアップが表示されません。代わりに、最新のファイルベースのバックアップだけが表示されます。ファイルベースのバックアップの成功または失敗は、ジョブモニタビューに表示されます。

image:anf-cba-image54.png["完了している手順のスクリーンショット。"]



== ファイルシステムのファイルベースのバックアップ情報を確認します

ブロック整合性チェックが成功すると、標準の SAP HANA データバックアップファイルが作成されます。CBAでは、ファイルベースのデータバックアップ処理用にHANAデータベースに設定されているバックアップパスが使用されます。命名規則は、ファイルベースのバックアップのバックアップポリシーの設定に従います。

....
vm-pr1:/hanabackup/PR1/file # ls -al *
DB_PR1:
total 3355880
drwxr-xr-- 2 pr1adm sapsys       4096 Jan  3 10:12 .
drwxr-x--- 4 pr1adm sapsys       4096 Dec 19 13:53 ..
-rw-r----- 1 pr1adm sapsys     155648 Jan  3 10:10 SnapCenter_SnapCenter_PR1_WeeklyBlockIntegrityCheck_Weekly_2023_01_03_10_10_19_databackup_0_1
-rw-r----- 1 pr1adm sapsys   83894272 Jan  3 10:11 SnapCenter_SnapCenter_PR1_WeeklyBlockIntegrityCheck_Weekly_2023_01_03_10_10_19_databackup_2_1
-rw-r----- 1 pr1adm sapsys 1627398144 Jan  3 10:12 SnapCenter_SnapCenter_PR1_WeeklyBlockIntegrityCheck_Weekly_2023_01_03_10_10_19_databackup_3_1
SYSTEMDB:
total 3092672
drwxr-xr-- 2 pr1adm sapsys       4096 Jan  3 10:12 .
drwxr-x--- 4 pr1adm sapsys       4096 Dec 19 13:53 ..
-rw-r----- 1 pr1adm sapsys     159744 Jan  3 10:10 SnapCenter_SnapCenter_PR1_WeeklyBlockIntegrityCheck_Weekly_2023_01_03_10_10_19_databackup_0_1
-rw-r----- 1 pr1adm sapsys 1577066496 Jan  3 10:12 SnapCenter_SnapCenter_PR1_WeeklyBlockIntegrityCheck_Weekly_2023_01_03_10_10_19_databackup_1_1
vm-pr1:/hanabackup/PR1/file #
....


== SAP HANA Studioでファイルベースのバックアップ情報を確認します

SAP HANA のバックアップカタログには、システムデータベースとテナントデータベースの両方のエントリが表示されます。次の図は、システムデータベースとテナントデータベースのバックアップカタログに含まれるCBAファイルベースのバックアップを示しています。

image:anf-cba-image55.png["次の図に、システムデータベースのバックアップカタログに含まれるCBAファイルベースのバックアップを示します。"]

image:anf-cba-image56.png["次の図は、テナントデータベースのバックアップカタログに含まれるCBAファイルベースのバックアップを示しています。"]

link:anf-cba-snapshot-based-backup-operations-of-non-data-volumes.html["次の記事：データボリューム以外のボリュームでのSnapshotベースのバックアップ処理。"]
