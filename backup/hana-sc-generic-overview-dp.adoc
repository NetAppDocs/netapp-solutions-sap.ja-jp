---
sidebar: sidebar 
permalink: backup/hana-sc-generic-overview-dp.html 
keywords: SAP HANA, SnapCenter, backup and recovery, Azure NetApp Files, FSx for NetApp ONTAP 
summary:  
---
= NetApp Snapshot テクノロジーによる SAP HANA データ保護について学ぶ
:allow-uri-read: 


[role="lead"]
NetApp Snapshot テクノロジーが、データベースのサイズに関係なく、数分で完了するバックアップで SAP HANA データベースを保護する方法をご覧ください。スナップショット コピー、高速リカバリのためのSnapRestore 、および二次保護のためのSnapVaultまたはAzure NetApp Filesバックアップによるレプリケーションを使用したバックアップおよびリカバリ戦略について学習します。

今日の企業では、SAP アプリケーションの継続的かつ中断のない可用性が求められています。企業は一貫したパフォーマンス レベルを期待しており、増え続けるデータ量やシステム バックアップなどの日常的なメンテナンス タスクのニーズに対応するため、日常的な操作を自動化する必要があります。SAP データベースのバックアップを実行することは重要なタスクであり、実稼働の SAP システムのパフォーマンスに大きな影響を与える可能性があります。

バックアップするデータの量が増える一方で、バックアップウィンドウは縮小しています。そのため、業務プロセスへの影響を最小限に抑えながらバックアップを実行できる時間を見つけるのは困難です。ビジネスコストを削減するために、SAP 実稼働システムと非実稼働システムのダウンタイムを最小限に抑える必要があるため、SAP システムの復元と回復に必要な時間は懸念事項です。



== スナップショットバックアップを使用したバックアップとリカバリ

NetApp Snapshot テクノロジーを使用すると、数分でデータベースのバックアップを作成できます。スナップショット コピーではストレージ プラットフォーム上の物理データ ブロックが移動されないため、スナップショット コピーの作成に必要な時間はデータベースのサイズとは無関係です。さらに、スナップショット テクノロジを使用すると、すべての操作がストレージ システムで実行されるため、ライブ SAP システムのパフォーマンスに影響はありません。したがって、ピーク時のダイアログまたはバッチ アクティビティ期間を考慮せずに、スナップショット コピーの作成をスケジュールできます。NetApp上の SAP の顧客は通常、1 日中に複数のオンライン スナップショット バックアップをスケジュールします。たとえば、6 時間ごとにスケジュールするのが一般的です。これらのスナップショット バックアップは通常、プライマリ ストレージ システムに 3 ～ 5 日間保存された後、削除されるか、長期保存のためにより安価なストレージに階層化されます。

スナップショット コピーは、復元および回復操作にも重要な利点をもたらします。復元操作では、バックアップの状態に基づいてファイル システム内のデータが復元されます。リカバリ操作は、データベース ログ バックアップを使用して、データベースの状態を特定の時点までロールフォワードするために使用されます。

NetApp SnapRestoreテクノロジーにより、現在利用可能なスナップショット バックアップに基づいて、データベース全体またはデータベースの一部のみを復元できます。復元プロセスは、データベースのサイズに関係なく、数秒で完了します。1 日中に複数のオンライン スナップショット バックアップを作成できるため、従来の 1 日 1 回のバックアップ アプローチと比較して、回復プロセスに必要な時間が大幅に短縮されます。最大 24 時間ではなく、最大数時間前のスナップショット コピーを使用して復元を実行できるため、フォワード リカバリ中に適用する必要があるトランザクション ログが少なくなります。従来のストリーミング バックアップと比較して、復元と回復に必要な時間が大幅に短縮されます。

スナップショット バックアップはアクティブなオンライン データと同じディスク システムに保存されるため、 NetApp、スナップショット コピー バックアップをセカンダリ ロケーションへのバックアップの代わりとしてではなく補足として使用することをお勧めします。ほとんどの復元およびリカバリ アクションは、プライマリ ストレージ システム上のSnapRestoreを使用して管理されます。セカンダリ ロケーションからの復元は、スナップショット コピーを含むプライマリ ストレージ システムが使用できない場合にのみ必要です。プライマリ ストレージで使用できなくなったバックアップを復元する必要がある場合は、セカンダリ バックアップを使用することもできます。

セカンダリ ロケーションへのバックアップは、プライマリ ストレージに作成されたスナップショット コピーに基づいています。したがって、SAP データベース サーバーとそのネットワークに負荷をかけることなく、データはプライマリ ストレージ システムから直接読み取られます。プライマリ ストレージはセカンダリ ストレージと直接通信し、 SnapVaultまたは ANF バックアップ機能を使用してバックアップ データを宛先に複製します。

SnapVaultと ANF バックアップは、従来のバックアップに比べて大きな利点があります。すべてのデータがソースから宛先に転送される最初のデータ転送の後、後続のすべてのバックアップでは、変更されたブロックのみがセカンダリ ストレージに複製されます。 変更されたブロックのみが保存先に保存されるため、追加の完全データベース バックアップでは消費されるディスク領域が大幅に削減されます。プライマリ ストレージ システムの負荷およびフル バックアップに要する時間は大幅に削減されます。デスティネーションには変更されたブロックだけが格納されるため、データベースのフル バックアップを追加しても、消費するディスク スペースが大幅に少なくて済みます。



== Snapshotバックアップおよびリストア処理の実行時間

次の図は、スナップショット バックアップ操作を使用する顧客の HANA Studio を示しています。この画像は、HANA データベース (サイズ約 4 TB) がスナップショット バックアップ テクノロジを使用して 1 分 20 秒でバックアップされ、ファイルベースのバックアップ操作では 4 時間以上かかっていることを示しています。

バックアップ ワークフロー全体の実行時間のうち最も大きな部分は、HANA データベース スナップショット操作の実行に必要な時間です。ストレージ スナップショット バックアップ自体は、HANA データベースのサイズに関係なく、数秒で完了します。

image:hana-sc-generic-image-001.png["幅=624、高さ=267"]



== 目標復旧時間の比較

このセクションでは、ファイルベースとストレージベースのスナップショット バックアップの目標復旧時間 (RTO) の比較を示します。RTO は、データベースの復元、回復、および起動に必要な時間の合計によって定義されます。



=== データベースのリストアに必要な時間

ファイルベースのバックアップでは、リストア時間はデータベースのサイズとバックアップインフラによって異なり、リストア速度は 1 秒あたりのメガバイト数で定義されます。たとえば、インフラで250MBpsの高速なリストア処理がサポートされている場合、4 TBのデータベースを永続性を維持した状態でリストアするには約4.5時間かかります。

NetApp Snapshot バックアップでは、復元時間はデータベースのサイズに依存せず、常に数秒の範囲になります。



=== データベースのリカバリに要する時間

リカバリ時間は、リストア後に適用する必要があるログの数によって異なります。この数は、データバックアップを実行する頻度によって決まります。

ファイルベースのデータバックアップでは、通常、バックアップスケジュールは 1 日に 1 回となります。バックアップによって本番環境のパフォーマンスが低下するため、通常はバックアップ頻度を高くすることはできません。したがって、最悪の場合は、フォワードリカバリ時に 1 日中に書き込まれたすべてのログを適用する必要があります。

スナップショット バックアップは、SAP HANA データベースのパフォーマンスに影響を与えないため、通常はより高い頻度でスケジュールされます。たとえば、スナップショットのバックアップが 6 時間ごとにスケジュールされている場合、次のスナップショットが作成される直前に障害が発生すると、最悪のケースでは過去 6 時間のログを適用する必要があります。毎日のファイルベースのバックアップでは、最悪の場合、過去 24 時間のログを適用する必要があります。



=== データベースの起動に必要な時間

データベースの開始時間は、データベースのサイズと、データをメモリにロードするのに必要な時間によって異なります。次の例では、データを1000Mbpsでロードできると仮定しています。4TBのメモリをメモリに装着するには、約1時間10分かかります。開始時間は、ファイルベースおよびSnapshotベースのリストア処理とリカバリ処理の場合と同じです。



=== 復元と回復のサンプル計算

次の図は、毎日のファイルベースのバックアップと、異なるスケジュールのスナップショット バックアップを使用した復元およびリカバリ操作の比較を示しています。

最初の2つのバーは、1日に1つのSnapshotバックアップを作成した場合でも、Snapshotバックアップからのリストア処理の速度が原因で、リストアとリカバリが43%に削減されることを示しています。1日に複数のSnapshotバックアップを作成すると、フォワードリカバリで適用するログが少なくなるため、ランタイムがさらに短縮されます。

また、次の図では、1日に4~6つのSnapshotバックアップを作成することを推奨しています。頻度を高くしても、全体的な実行時間に大きな影響はありません。

image:hana-sc-generic-image-002.png["幅=624、高さ=326"]



== バックアップとクローニング処理の高速化のユースケースと価値

バックアップの実行は、あらゆるデータ保護戦略に欠かせない要素です。バックアップは定期的にスケジュールされ、システム障害からリカバリできます。これは最も分かりやすいユースケースですが、SAPライフサイクル管理タスクにはバックアップとリカバリの高速化が不可欠なものもあります。

SAP HANA システムのアップグレードは、アップグレード前のオンデマンド バックアップと、アップグレードが失敗した場合に実行可能な復元操作が、全体的な計画ダウンタイムに大きな影響を与える例です。4 TB のデータベースの例では、計画されたダウンタイムを 8 時間短縮できます。つまり、スナップショット ベースのバックアップと復元操作を使用することで、エラーの分析と修正にさらに 8 時間かけることができます。

もう 1 つのユース ケースは、異なるデータ セットまたはパラメーターを使用して複数の反復でテストを実行する必要がある一般的なテスト サイクルです。高速バックアップおよび復元操作を活用すると、テスト サイクル内で保存ポイントを簡単に作成し、テストが失敗した場合や繰り返す必要がある場合に、システムを以前の保存ポイントのいずれかにリセットできます。これにより、テストをより早く終了したり、同時により多くのテストを実行できるようになり、テスト結果が向上します。

image:hana-sc-generic-image-003.png["幅=618、高さ=279"]

スナップショット バックアップが実装されると、HANA データベースのコピーを必要とする他の複数のユース ケースに対応するために使用できるようになります。利用可能なスナップショット バックアップの内容に基づいて新しいボリュームを作成できます。この操作の実行時間は、ボリュームのサイズに関係なく数秒です。

最も一般的な使用ケースは、実稼働システムのデータをテスト システムまたは QA システムにコピーする必要がある SAP システム リフレッシュです。ONTAPまたは ANF のクローン機能を利用すると、実稼働システムの任意の Snapshot コピーからテスト システムのボリュームを数秒でプロビジョニングできます。次に、新しいボリュームをテスト システムに接続し、HANA データベースを回復する必要があります。

2 番目のユースケースは、実稼働システムの論理的な破損に対処するために使用される修復システムの作成です。この場合、実動システムの古いスナップショット バックアップを使用して修復システムが開始されます。修復システムは、破損が発生する前のデータを含む実動システムと同一のクローンです。次に、修復システムを使用して問題を分析し、破損する前に必要なデータをエクスポートします。

最後のユースケースは、レプリケーションを停止せずに、したがって災害復旧セットアップの RTO と復旧ポイント目標 (RPO) に影響を与えずに災害復旧フェールオーバー テストを実行する機能です。ONTAP SnapMirrorレプリケーションまたは ANF クロスリージョン レプリケーションを使用してデータを災害復旧サイトに複製すると、実稼働スナップショット バックアップも災害復旧サイトで使用できるようになるため、災害復旧テスト用の新しいボリュームの作成に使用できるようになります。

image:hana-sc-generic-image-004.png["幅=627、高さ=328"]
