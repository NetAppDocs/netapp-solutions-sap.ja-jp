---
sidebar: sidebar 
permalink: backup/anf-cba-backup-operations-with-hana-system-replication.html 
keywords: system replication, cba, hsr, multiple host, standby host 
summary: このセクションでは、HANAシステムレプリケーションを使用してバックアップ処理を実行する方法について説明します。 
---
= HANAシステムレプリケーションによるバックアップ処理
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


link:anf-cba-restore-and-recovery-from-snapshot-backup.html["以前：Snapshotバックアップからリストアしてリカバリする。"]



== [ストレージ][ Snapshotバックアップ][ HANAシステムレプリケーション]をクリックします

バックアップ処理に必要なSQLコマンドはセカンダリSAP HANAホストでは実行できないため、バックアップ処理は常にプライマリSAP HANAホストで実行されます。

SAP HANA のバックアップ処理では、プライマリとセカンダリの SAP HANA ホストが単一のエンティティになります。同じSAP HANAバックアップカタログを共有し、バックアップがプライマリとセカンダリのどちらのSAP HANAホストで作成されたかに関係なく、バックアップをリストアとリカバリに使用します。

いずれかのバックアップをリストアに使用したり、両方のホストからログバックアップを使用してリカバリを転送したりするには、両方のホストからアクセスできる共有ログバックアップの場所が必要です。共有ストレージボリュームを使用することを推奨します。ただし、ログバックアップのデスティネーションは、共有ボリューム内のサブディレクトリに分ける必要があります。

各 SAP HANA ホストには、独自のストレージボリュームがあります。ストレージベースのSnapshotを使用してバックアップを実行すると、プライマリSAP HANAホストのストレージボリュームにデータベースと整合性のあるSnapshotコピーが作成されます。

image:anf-cba-image102.png["この図は、プライマリSAP HANAホストのストレージボリュームに、データベースと整合性のあるSnapshotコピーが作成される仕組みを示しています。"]

ホスト2へのフェイルオーバーが実行されると、ホスト2がプライマリSAP HANAホストになり、ホスト2でバックアップが実行され、ホスト2のストレージボリュームにSnapshotバックアップが作成されます。

ホスト 2 で作成されたバックアップは、ストレージレイヤで直接リストアできます。ホスト 1 に作成したバックアップを使用する場合は、ホスト 1 のストレージボリュームからホスト 2 のストレージボリュームにバックアップをコピーする必要があります。フォワードリカバリでは、両方のホストからのログバックアップが使用されます。

image:anf-cba-image103.png["この図は、フォワードリカバリで両方のホストのログバックアップがどのように使用されるかを示しています。"]



== CBAおよびHSRに対応したHANAシステムを使用したバックアップ処理

ここで簡単に説明したように、HSRに対応したHANAシステムを使用したバックアップ処理については、いくつかの点を考慮する必要があります。

* バックアップ処理は、プライマリHANAホストでのみ実行できます。したがって、CBAはバックアップ処理を実行するときに、どのホストが現在プライマリであるかを認識する必要があります。
+
** バックアップSQLステートメントは、現在のプライマリホストに対して実行する必要があります。
** Snapshotバックアップはプライマリホストデータボリュームでのみ実行してください。セカンダリホストデータボリュームは整合性がないため、リストアとリカバリの処理には使用できません。


* Snapshotバックアップの保持管理は、両方のホストで実行する必要があります。たとえば、セカンダリホストへのフェイルオーバーが実行された場合、以前のプライマリホストのバックアップも、すべてのレイヤ、CBA内、ANFボリューム、HANAバックアップカタログ内の定義された保持期間に基づいて削除する必要があります。そうしないと、ログバックアップの保持管理に基づいて古いログバックアップを削除すると、古いデータバックアップが原因でブロックされます。


CBAでは、プライマリとセカンダリの両方のHANAホストが、次の図に示すように通常のHANAシステムと同じように設定されます。設定時の唯一の違いは、このHANAシステムがHSRラレーションの一部であることをCBAに通知するためのチェックボックスです。CBAはホストからHSRステータスを読み取り、どのホストが一緒に属しているか、どのホストがプライマリまたはセカンダリであるかを特定できます。CBA内部では、これら2つのホストは単一のエンティティとして扱われ、バックアップは現在のプライマリホストに対してのみ実行され、保持管理は両方のホストに対して実行されます。


NOTE: CBAでは、2ホスト構成のHSRのみがサポートされます。

image:anf-cba-image104.png["次の図は、CBAが2ホスト構成のHSRのみをサポートする方法を示しています。"]



== インストールと設定の手順の概要

HSRに対応したHANAシステムで必要な設定手順には若干の違いがあります。このセクションでは、すでに説明されている標準構成手順との違いのみを強調します。

. プライマリHSRホストのHANAシステムデータベースでバックアップユーザを作成します。
. Cloud Backup for Applicationsでプライマリホストを追加し、HANAシステムを設定します。
+
.. 設定時に* HANA System Replication *を選択します。
+
image:anf-cba-image105.png["完了している手順のスクリーンショット。"]

.. プライマリホストのストレージフットプリントを追加します。
+
image:anf-cba-image106.png["完了している手順のスクリーンショット。"]



. 新しいHANAシステムにHSRアイコンが表示されます。
+
image:anf-cba-image107.png["完了している手順のスクリーンショット。"]

. Cloud Backup for Applicationsでセカンダリホストを追加し、HANAシステムを設定します。
+
.. 設定時に* HANA System Replication *を選択します。
+
image:anf-cba-image108.png["完了している手順のスクリーンショット。"]

.. セカンダリホストのストレージフットプリントを追加します。
+
image:anf-cba-image109.png["完了している手順のスクリーンショット。"]

+
これで、両方のシステムにHSRアイコンが表示されます。

+
image:anf-cba-image110.png["完了している手順のスクリーンショット。"]



. プライマリとセカンダリのHANAシステムにバックアップポリシーを追加
+

NOTE: 保持管理は両方のHANAホストで実行されるため、両方のシステムに同じポリシーを追加する必要があります。



定義されたポリシーに基づいてバックアップが実行されるようになりました。CBAは、常にプライマリHANAホストでSnapshotバックアップ処理を開始します。

link:anf-cba-backup-operations-with-hana-multiple-host-systems.html["次の記事：HANAマルチホストシステムでのバックアップ処理"]
