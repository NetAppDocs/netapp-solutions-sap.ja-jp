---
sidebar: sidebar 
permalink: backup/hana-sc-generic-restore.html 
keywords: SAP HANA, SnapCenter, backup and recovery, Azure NetApp Files, FSx for NetApp ONTAP 
summary:  
---
= SnapCenterを使用した SAP HANA データベースの復元とリカバリ
:allow-uri-read: 


[role="lead"]
自動または手動のリカバリ オプションを備えたSnapCenterを使用して、SAP HANA システムを復元およびリカバリします。これには、完全なシステム復元、 ONTAP上の HANA データベース、 Azure NetApp Files、および FSx for ONTAPの単一テナント復元が含まれます。

SnapCenter は、次の復元およびリカバリ操作をサポートしています。

* 単一テナントのSAP HANA MDCシステム
+
** エンドツーエンドの自動復元と回復
** エンドツーエンドの自動復元と手動リカバリ（選択可能）


* 複数のテナントを持つSAP HANA MDCシステム
+
** エンドツーエンドの自動復元、リカバリは手動で行う必要がある


* 単一テナントのリストア
+
** エンドツーエンドの自動復元、リカバリは手動で行う必要がある





NOTE: 自動リカバリは、HANA プラグインが HANA データベース ホストに展開され、HANA システムがSnapCenterによって自動検出された場合にのみサポートされます。中央プラグイン ホスト構成では、 SnapCenterによる復元操作後に手動でリカバリを実行する必要があります。


NOTE: プライマリ ANF ボリュームからの復元がサポートされています。ANF バックアップからの復元はまだサポートされていません。インプレース復元または ANF バックアップからの新しいボリュームへの復元は、Azure ポータルまたは CLI を使用して手動で実行する必要があります。



== 単一テナントによるSAP HANA MDCシステムの自動リストアとリカバリ

復元操作は、リソース トポロジ ビューでスナップショット バックアップを選択し、[復元] をクリックすることによって開始されます。

image:hana-sc-generic-image-098.png["幅=601、高さ=294"]

ANF、FSx for ONTAP 、またはONTAPストレージ システム上の NFS を使用する HANA システムでは、プライマリ ボリューム スナップショットのボリューム復元操作の有無にかかわらず、完全な復元を選択できます。

* ボリュームを元に戻さない完全なリソースでは、Single File SnapRestore (SFSR) を使用してデータベースのすべてのファイルを復元します。
* ボリュームの復元を含む完全なリソースでは、ボリューム ベースの復元操作 (VBSR) を使用して、完全なボリュームを選択したスナップショットの状態に戻します。



NOTE: アクティブなSnapVaultまたはSnapMirrorレプリケーション スナップショットよりも古いスナップショットに復元する必要がある場合、ボリュームの復元は使用できません。


NOTE: ボリュームの復元操作では、復元操作に選択されたスナップショットよりも新しいすべてのスナップショット バックアップが削除されます。


NOTE: SFSR による復元はボリュームの復元操作とほぼ同じくらい高速ですが、バックグラウンド プロセスがメタデータ操作を完了するまで、すべてのスナップショット操作がブロックされます。

image:hana-sc-generic-image-099.png["幅=300"]

FC SAN を使用するベアメタル ホスト上の HANA システムでは、ボリュームの復元 (VBSR) はサポートされておらず、代わりに復元操作には常に SFSR が使用されます。VMFS を使用した VMware 上で実行される HANA システムでは、クローン、マウント、コピー操作が使用されます。

image:hana-sc-generic-image-100.png["幅=345、高さ=325"]

セカンダリ バックアップから復元する場合は、アーカイブの場所を選択する必要があります。

image:hana-sc-generic-image-101.png["幅=345、高さ=323"]

リカバリ スコープを使用すると、ログ バックアップを使用せずに、「最新の状態」、「ポイント イン タイム」、またはセーブ ポイント リカバリを選択できます。リカバリなしを選択した場合、 SnapCenterは復元操作のみを実行し、リカバリは説明されているように手動で行う必要があります。 link:hana-sc-generic-restore.html#manual-recovery-with-hana-studio["HANA Studio を使用した手動リカバリ"]。


NOTE: SnapCenter は、ログ バックアップとカタログ バックアップの場所に SAP HANA で構成されたパスを使用します。追加の場所に階層化されたバックアップがある場合は、これらの追加パスを追加できます。

image:hana-sc-generic-image-102.png["幅=346、高さ=324"]

オプションで、復元前および復元後のスクリプトを追加できます。

image:hana-sc-generic-image-103.png["幅=348、高さ=326"]

image:hana-sc-generic-image-104.png["幅=359、高さ=335"]

概要画面で [完了] をクリックすると、復元および回復操作が開始されます。

image:hana-sc-generic-image-105.png["幅=361、高さ=336"]

復元と回復のワークフローは、主に 3 つのセクションに分けられます。

* HANAシステムのシャットダウン
* リストア処理を実行します
+
** ファイルシステム固有の準備、例：アンマウント操作
** スナップショットの復元操作
** ファイルシステム固有の後処理、例えばマウント操作


* HANAリカバリPITリカバリ
+
** システムデータベースのリカバリ
** テナントデータベースのリカバリ




image:hana-sc-generic-image-106.png["幅=357、高さ=439"]



== HANA Studio を使用した手動リカバリ

SAP HANA Studio とSnapCenterを使用して、単一または複数のテナントを持つ SAP HANA MDC システムを復元および回復するには、次の手順を実行します。

. SAP HANA Studio でリストアとリカバリのプロセスを準備します。
+
.. システムデータベースのリカバリを選択し、 SAP HANA システムのシャットダウンを確認します。
.. 回復の種類を選択し、バックアップ カタログの場所を指定します。
.. データバックアップのリストが表示されます。外部バックアップ ID を表示するには、 Backup を選択します。


. SnapCenter でリストアプロセスを実行します。
+
.. リソースのトポロジ ビューで、プライマリ ストレージから復元する場合は [ローカル コピー] を選択し、セカンダリ バックアップ ストレージから復元する場合は [ボールト コピー] を選択します。
.. SAP HANA Studio の外部バックアップの ID またはコメントフィールドと一致する SnapCenter バックアップを選択します。
.. リストアプロセスを開始します。


. SAP HANA Studio を使用して、システムデータベースのリカバリプロセスを実行します。
+
.. バックアップ・リストから [ 更新 ] をクリックし ' リカバリに使用できるバックアップを選択します（緑色のアイコンが表示されます）
.. リカバリプロセスを開始します。リカバリプロセスが完了すると、システムデータベースが起動します。


. SAP HANA Studio を使用してテナントデータベースのリカバリプロセスを実行します。
+
.. [Recover Tenant Database] を選択して、リカバリするテナントを選択します。
.. リカバリタイプとログのバックアップ先を選択します。
.. データバックアップのリストが表示されます。データボリュームはすでにリストアされているため、テナントのバックアップは使用可能（緑）と表示されます。
.. このバックアップを選択し、リカバリプロセスを開始します。リカバリプロセスが完了すると、テナントデータベースが自動的に起動します。


. 複数のテナントを持つ HANA システムの場合は、テナントごとに手順 4 を繰り返します。



NOTE: SAP HANA Cockpit を使用した手動リカバリも同じ手順で実行されます。

次のセクションでは、単一テナントの SAP HANA MDC システムの復元およびリカバリ操作の手順について説明します。

HANA Studio で、[バックアップとリカバリ] および [システム データベースのリカバリ] を選択します。

image:hana-sc-generic-image-107.png["幅=450、高さ=368"]

シャットダウン操作を確認します。HANA システムがまだ実行されている場合にのみ必要です。

image:hana-sc-generic-image-108.png["幅=349、高さ=83"]

回復操作を選択します。この例では、最新の状態に回復します。

image:hana-sc-generic-image-109.png["幅=345、高さ=359"]

バックアップ カタログの場所を指定します。

image:hana-sc-generic-image-110.png["幅=343、高さ=356"]

HANA Studio は、HANA バックアップ カタログに保存されている最新のバックアップを一覧表示します。

バックアップ カタログの内容に基づいて、利用可能なバックアップのリストが表示されます。必要なバックアップを選択し、外部バックアップ ID をメモします。この例では、最新のバックアップです。

image:hana-sc-generic-image-111.png["幅=391、高さ=283"]

SnapCenter GUI から、リソース トポロジ ビューを選択し、復元するバックアップ (この例では、最新のプライマリ バックアップ) を選択します。復元を開始するには、「復元」アイコンをクリックします。

image:hana-sc-generic-image-112.png["幅=601、高さ=294"]

SnapCenter復元ウィザードが起動します。ボリュームベースの復元を使用するには、復元タイプとして「完全なリソースとボリュームの復元」を選択します。

image:hana-sc-generic-image-113.png["幅=346、高さ=325"]

SnapCenterワークフローからリカバリ操作を除外するには、「リカバリなし」を選択します。

image:hana-sc-generic-image-114.png["幅=358、高さ=336"]

「完了」をクリックすると復元操作が開始されます。

image:hana-sc-generic-image-115.png["幅=361、高さ=339"]

SnapCenterは現在、復元操作を実行しています。

* ファイルシステム固有の準備、例：アンマウント操作
* スナップショットの復元操作
* ファイルシステム固有の後処理、例：マウント操作


image:hana-sc-generic-image-116.png["幅=322、高さ=398"]

スナップショットがSnapCenterによって復元されると、HANA データ ボリュームのシステムおよびテナント データベース サブディレクトリで snapshot_databackup_0_1 ファイルが使用できるようになります。このファイルは、HANA データベース スナップショットの作成中に HANA データベースによって作成されました。HANA はバックアップ操作が完了するとファイルを削除するため、ファイルはスナップショット バックアップ内でのみ表示されます。これらのファイルは、あらゆる回復操作に必要です。リカバリ後、ファイルは HANA データベースによって削除されます。

....

hana-1:~ # cd /hana/data/SS1/mnt00001/
hana-1:/hana/data/SS1/mnt00001 # ls -al *
-rw-r--r-- 1 ss1adm sapsys 16 Aug 26 06:00 nameserver.lck
hdb00001:
total 4992236
drwxr-x--- 2 ss1adm sapsys 4096 Aug 26 06:00 .
drwxr-x--- 5 ss1adm sapsys 4096 Aug 26 06:00 ..
-rw-r----- 1 ss1adm sapsys 0 Nov 3 2020 __DO_NOT_TOUCH_FILES_IN_THIS_DIRECTORY__
-rw-r----- 1 ss1adm sapsys 5100273664 Aug 26 06:00 datavolume_0000.dat
-rw-r----- 1 ss1adm sapsys 36 Aug 25 10:30 landscape.id
-rw-r----- 1 ss1adm sapsys 163840 Aug 26 06:00 snapshot_databackup_0_1
hdb00002.00003:
total 201420
drwxr-xr-- 2 ss1adm sapsys 4096 Nov 3 2020 .
drwxr-x--- 5 ss1adm sapsys 4096 Aug 26 06:00 ..
-rw-r--r-- 1 ss1adm sapsys 0 Nov 3 2020 __DO_NOT_TOUCH_FILES_IN_THIS_DIRECTORY__
-rw-r--r-- 1 ss1adm sapsys 335544320 Aug 26 06:00 datavolume_0000.dat
hdb00003.00003:
total 4803140
drwxr-xr-- 2 ss1adm sapsys 4096 Aug 26 06:00 .
drwxr-x--- 5 ss1adm sapsys 4096 Aug 26 06:00 ..
-rw-r--r-- 1 ss1adm sapsys 0 Nov 3 2020 __DO_NOT_TOUCH_FILES_IN_THIS_DIRECTORY__
-rw-r--r-- 1 ss1adm sapsys 4898947072 Aug 26 06:00 datavolume_0000.dat
-rw-r----- 1 ss1adm sapsys 159744 Aug 26 06:00 snapshot_databackup_0_1
hana-1:/hana/data/SS1/mnt00001 #

....
SAP HANA Studio に移動し、「更新」をクリックして利用可能なバックアップのリストを更新します。SnapCenterで復元されたバックアップは、バックアップ リストに緑色のアイコンで表示されます。バックアップを選択し、「次へ」をクリックします。

image:hana-sc-generic-image-117.png["幅=400、高さ=290"]

ログバックアップの場所を指定します。次へをクリックします。


NOTE: SAP HANA Studio は、ログ バックアップとカタログ バックアップの場所に SAP HANA で構成されたパスを使用します。追加の場所に階層化されたバックアップがある場合は、これらの追加パスを追加できます。

image:hana-sc-generic-image-118.png["幅=465、高さ=296"]

必要に応じて、他の設定を選択します。［ デルタバックアップを使用 ］ が選択されていないことを確認します。次へをクリックします。

image:hana-sc-generic-image-119.png["幅=466、高さ=296"]

リカバリ設定を確認し、 [ 完了 ] をクリックします。

SQL ステートメントの表示をクリックすると、HANA Studio はリカバリ操作のために実行される SQL コマンドを表示します。

image:hana-sc-generic-image-120.png["幅=464、高さ=295"]

回復プロセスが開始されます。システム データベースの回復が完了するまで待ちます。

image:hana-sc-generic-image-121.png["幅=376、高さ=239"]

SAP HANA Studio で、システムデータベースのエントリを選択し、 Backup Recovery - Recover Tenant Database を開始します。

image:hana-sc-generic-image-122.png["幅=476、高さ=315"]

リカバリするテナントを選択し、 Next （次へ）をクリックします。

image:hana-sc-generic-image-123.png["幅=342、高さ=355"]

リカバリタイプを指定して、 Next （次へ）をクリックします。

image:hana-sc-generic-image-124.png["幅=343、高さ=356"]

バックアップカタログの場所を確認し、 Next （次へ）をクリックします。

image:hana-sc-generic-image-125.png["幅=342、高さ=355"]

テナント データベースのシャットダウンを確認します。

image:hana-sc-generic-image-126.png["幅=348、高さ=85"]

システム データベースの回復前にデータ ボリュームの復元が実行されているため、テナント バックアップはすぐに利用できます。緑色で強調表示されたバックアップを選択し、「次へ」をクリックします。

image:hana-sc-generic-image-127.png["幅=433、高さ=349"]

ログバックアップの場所を指定します。次へをクリックします。


NOTE: SAP HANA Studio は、ログ バックアップとカタログ バックアップの場所に SAP HANA で構成されたパスを使用します。追加の場所に階層化されたバックアップがある場合は、これらの追加パスを追加できます。

image:hana-sc-generic-image-128.png["幅=384、高さ=310"]

必要に応じて、他の設定を選択します。［ デルタバックアップを使用 ］ が選択されていないことを確認します。次へをクリックします。

image:hana-sc-generic-image-129.png["幅=384、高さ=310"]

リカバリ設定を確認し、 [ 完了 ] をクリックします。

SQL ステートメントの表示をクリックすると、HANA Studio はリカバリ操作のために実行される SQL コマンドを表示します。

image:hana-sc-generic-image-130.png["幅=380、高さ=307"]

リカバリが完了してテナントデータベースが起動するまで待ちます。

image:hana-sc-generic-image-131.png["幅=378、高さ=305"]

テナントのリカバリが完了すると、SAP HANA システムが起動して実行されます。


NOTE: 複数のテナントを持つ SAP HANA MDC システムの場合、テナントごとにテナント回復を繰り返す必要があります。



== SQLコマンドによる手動リカバリ

HANA システムのリカバリには SQL ステートメントを使用することもできます。

まず、システム データベースを回復する必要があります。

....

HDBSettings.sh recoverSys.py --command="RECOVER DATABASE UNTIL TIMESTAMP '2026-08-26 10:55:49' USING CATALOG PATH ('mnt/log-backup/SYSTEMDB') USING LOG PATH ('mnt/log-backup/SYSTEMDB') USING SNAPSHOT"
....
2 番目の手順として、システム データベースに接続し、テナント データベースの回復を開始する必要があります。この例では、テナント データベースは SS1 です。

....

hdbsql SYSTEMDB=> RECOVER DATABASE FOR SS1 UNTIL TIMESTAMP '2026-08-26 10:55:49' USING CATALOG PATH ('mnt/log-backup/DB_SS1') USING LOG PATH ('mnt/log-backup/DB_SS1') USING SNAPSHOT
....


== 単一テナントの復元と回復

SnapCenterを使用した単一テナントの復元およびリカバリ操作は、前のトピックで説明したワークフローと非常によく似ています。 link:hana-sc-generic-restore.html#manual-recovery-with-hana-studio["HANA Studio を使用した手動リカバリ"]。

SAP HANA Studio および SnapCenter を使用して SAP HANA MDC のシングルテナントシステムをリストアおよびリカバリするには、次の手順を実行します。

. SAP HANA Studio でリストアとリカバリのプロセスを準備します。
+
.. [テナント データベースの回復] を選択し、テナント データベースのシャットダウンを確認します。
.. 回復の種類を選択し、バックアップ カタログの場所を指定します。
.. データバックアップのリストが表示されます。外部バックアップ ID を表示するには、 Backup を選択します。


. SnapCenter でリストアプロセスを実行します。
+
.. リソースのトポロジ ビューで、プライマリ ストレージから復元する場合は [ローカル コピー] を選択し、セカンダリ バックアップ ストレージから復元する場合は [ボールト コピー] を選択します。
.. SAP HANA Studio の外部バックアップの ID またはコメントフィールドと一致する SnapCenter バックアップを選択します。
.. テナントの復元プロセスを開始します。


. SAP HANA Studio を使用してテナントデータベースのリカバリプロセスを実行します。
+
.. バックアップ・リストから [ 更新 ] をクリックし ' リカバリに使用できるバックアップを選択します（緑色のアイコンが表示されます）
.. 回復プロセスを開始します。回復プロセスが完了すると、テナント データベースが起動します。






== 非データボリュームの復元

非データ ボリュームの復元操作は、非データ ボリューム リソースのトポロジ ビューでスナップショット バックアップを選択し、[復元] をクリックすることによって開始されます。

image:hana-sc-generic-image-132.png["幅=601、高さ=294"]

NFS の非データ ボリュームの場合、完全なリソース (VBSR) またはファイル レベル (SFSR) の復元操作を選択できます。ファイル レベルの復元では、復元操作の対象としてすべてのファイルまたは個々のファイルを定義できます。

image:hana-sc-generic-image-133.png["幅=369、高さ=344"]
