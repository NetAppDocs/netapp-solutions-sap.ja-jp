---
sidebar: sidebar 
permalink: backup/anf-cba-restore-and-recovery-from-snapshot-backup.html 
keywords: restore, recovery, operation, system database 
summary: このセクションでは、Snapshotバックアップからリストアおよびリカバリを実行する方法について説明します。 
---
= Snapshotバックアップからのリストアとリカバリ
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


link:anf-cba-snapshot-based-backup-operations-of-global-non-data-volumes.html["以前：データボリューム以外のグローバルボリュームのSnapshotベースのバックアップ処理。"]

[role="lead"]
次のセクションでは、HANA MDCシングルホスト、シングルテナントシステムのリストアとリカバリのワークフローについて説明します。マルチホストシステムの違いを強調表示します。以下の例では、手動リカバリを実行するツールとして SAP HANA Studio を使用しています。リカバリ処理には、 SAP HANA Cockpit または HANA の SQL ステートメントを使用することもできます。

SAP HANA StudioとCloud Backup for Applicationsを使用してSAP HANA MDCシングルテナントシステムをリストアおよびリカバリするには、次の手順を実行します。

. SAP HANA Studio でリストアとリカバリのプロセスを準備します。
+
.. [システムデータベースのリカバリ]*を選択し、SAP HANAシステムのシャットダウンを確認します。
.. リカバリタイプとログのバックアップ先を選択します。
+
データバックアップのリストが表示されます。

.. 該当するバックアップを選択し、外部バックアップ ID を確認します。


. HANA データボリュームをアンマウントします。
. Cloud Backup for Applicationsを使用してリストアプロセスを実行します。
+
.. バックアップビューで、 SAP HANA Studio の外部バックアップの ID またはコメントフィールドに一致するバックアップを選択します。
.. リストア処理を開始するには、コンテキストメニューで*[リストア]*を選択します。


. HANA データボリュームをマウント
. SAP HANA Studio を使用して、システムデータベースのリカバリプロセスを実行します。
+
.. バックアップリストの*[リフレッシュ]*をクリックし、リカバリに使用できるバックアップ（緑色のアイコンで示されます）を選択します。
.. リカバリ処理を開始します。
+
リカバリ処理が完了すると、システムデータベースが起動します。



. SAP HANA Studio を使用してテナントデータベースのリカバリプロセスを実行します。
+
.. [Recover Tenant Database]*を選択し、リカバリするテナントを選択します。
.. リカバリタイプとログのバックアップ先を選択します。


. データバックアップのリストが表示されます。データボリュームはすでにリストアされているため、テナントのバックアップには使用可能（緑）と表示されます。
+
.. バックアップを選択し、リカバリプロセスを開始します。リカバリプロセスが完了すると、テナントデータベースが自動的に起動します。




データバックアップのリストが表示されます。データボリュームはすでにリストアされているため、テナントのバックアップには使用可能（緑）と表示されます。バックアップを選択し、リカバリプロセスを開始します。リカバリプロセスが完了すると、テナントデータベースが自動的に起動します。

以下に、HANAシステムPR1のリストア処理とリカバリ処理の手順を示します。



== リストアとリカバリの処理を準備

. SAP HANA Studioでシステムデータベースのリカバリを開始するには、*[バックアップとリカバリ]*>*[システムデータベースのリカバリ]*に移動します。
+
image:anf-cba-image79.png["完了している手順のスクリーンショット。"]

+
image:anf-cba-image80.png["完了している手順のスクリーンショット。"]

. リカバリ・タイプを選択して ' ［ * 次へ * ］ をクリックします
+
image:anf-cba-image81.png["完了している手順のスクリーンショット。"]

. バックアップカタログの場所を指定し、*[次へ]*をクリックします。
+
image:anf-cba-image82.png["完了している手順のスクリーンショット。"]

. HANAバックアップカタログの内容に基づいて、使用可能なバックアップのリストが表示されます。必要なバックアップを選択し、外部バックアップID（最新のバックアップなど）をメモします。
+
image:anf-cba-image83.png["完了している手順のスクリーンショット。"]

. すべてのデータボリュームをアンマウントします。
+
....
umount /hana/data/PR1/mnt00001
....
+

NOTE: SAP HANA マルチホストシステムの場合は、各ホストのすべてのデータボリュームをアンマウントする必要があります。





== HANAデータベースをリストア

. リストア処理を開始するには、[Backup]ビューで、HANA Studioにも表示されるバックアップを選択し、コンテキストメニューから[Restore]を選択します。
+
image:anf-cba-image84.png["完了している手順のスクリーンショット。"]

. 次の手順では、リストア処理のプリスクリプトとポストスクリプトを指定できます。
+
image:anf-cba-image85.png["完了している手順のスクリーンショット。"]

+
Cloud Backup for Applicationsジョブログにリストア処理の進捗状況が表示されます。

+
image:anf-cba-image86.png["完了している手順のスクリーンショット。"]

. リストアプロセスが完了してデータボリュームがマウントされるまで待ちます。
+
....
mount /hana/data/SP1/mnt00001
....
+

NOTE: SAP HANAマルチホストシステムの場合は、各ホストのすべてのデータボリュームをマウントする必要があります。





== システムデータベースをリカバリします

. 使用可能なバックアップのリストを更新するには、 SAP HANA Studio に移動して、更新をクリックします。Cloud Backup for Applicationsでリストアされたバックアップは、バックアップのリストに緑色のアイコンで表示されます。バックアップを選択し、 Next （次へ）をクリックします。
+
image:anf-cba-image87.png["完了している手順のスクリーンショット。"]

. ログバックアップの場所を指定します。「 * 次へ * 」をクリックします。
+
image:anf-cba-image88.png["完了している手順のスクリーンショット。"]

. 必要に応じて、他の設定を選択します。［ デルタバックアップを使用 ］ が選択されていないことを確認します。「 * 次へ * 」をクリックします。
+
image:anf-cba-image89.png["完了している手順のスクリーンショット。"]

. リカバリ設定を確認し、*[終了]*をクリックします。
+
image:anf-cba-image90.png["完了している手順のスクリーンショット。"]

. リカバリプロセスが開始されます。システムデータベースのリカバリが完了するまで待ちます。
+
image:anf-cba-image91.png["完了している手順のスクリーンショット。"]





== テナントデータベースをリカバリ

. SAP HANA Studioで、システムデータベースのエントリを選択し、*[バックアップとリカバリ]*>*[テナントデータベースのリカバリ]*に移動します。
+
image:anf-cba-image92.png["完了している手順のスクリーンショット。"]

. リカバリするテナントを選択し、*[次へ]*をクリックします。
+
image:anf-cba-image93.png["完了している手順のスクリーンショット。"]

. リカバリタイプを指定して、 Next （次へ）をクリックします。
+
image:anf-cba-image94.png["完了している手順のスクリーンショット。"]

. バックアップカタログの場所を確認し、*[次へ]*をクリックします。
+
image:anf-cba-image95.png["完了している手順のスクリーンショット。"]

. テナントデータベースがオフラインであることを確認します。[OK] をクリックして続行します。
+
image:anf-cba-image96.png["完了している手順のスクリーンショット。"]

+
システムデータベースのリカバリ前にデータボリュームのリストアが実行されたため、テナントバックアップをすぐに使用できます。

. 緑色でハイライト表示されたバックアップを選択し、*[Next]*をクリックします。
+
image:anf-cba-image97.png["完了している手順のスクリーンショット。"]

. ログバックアップの場所を確認し、*[次へ]*をクリックします。
+
image:anf-cba-image98.png["完了している手順のスクリーンショット。"]

. 必要に応じて、他の設定を選択します。[Use Delta Backups]*が選択されていないことを確認します。「 * 次へ * 」をクリックします。
+
image:anf-cba-image99.png["完了している手順のスクリーンショット。"]

. リカバリ設定を確認し、*[終了]*をクリックしてテナントデータベースのリカバリプロセスを開始します。
+
image:anf-cba-image100.png["完了している手順のスクリーンショット。"]

. リカバリが完了してテナントデータベースが起動するまで待ちます。
+
image:anf-cba-image101.png["完了している手順のスクリーンショット。"]

+
SAP HANA システムは稼働中です。

+

NOTE: 複数のテナントがあるSAP HANA MDCシステムの場合は、テナントごとに手順16~25を繰り返す必要があります。



link:anf-cba-backup-operations-with-hana-system-replication.html["次の記事：HANAシステムレプリケーションによるバックアップ処理"]
