---
sidebar: sidebar 
permalink: backup/amazon-fsx-snapcenter-architecture.html 
keywords: snapcenter, scope, data protection strategy, example lab setup 
summary: SnapCenter は、アプリケーションと整合性のあるデータ保護を実現する拡張性に優れたユニファイドプラットフォームです。SnapCenter では一元的な管理と監視が可能ですが、一方で、アプリケーション固有のバックアップ、リストア、クローニングのジョブの管理を各ユーザに委譲することができます。SnapCenter を使用すれば、データベース管理者やストレージ管理者は、さまざまなアプリケーションやデータベースのバックアップ、リストア、クローニングの処理を 1 つのツールで管理できます。SnapCenter は、ネットアップのデータファブリック内のすべてのエンドポイントのデータを管理します。 
---
= SnapCenter アーキテクチャ
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


[role="lead"]
SnapCenter は、アプリケーションと整合性のあるデータ保護を実現する拡張性に優れたユニファイドプラットフォームです。SnapCenter では一元的な管理と監視が可能ですが、一方で、アプリケーション固有のバックアップ、リストア、クローニングのジョブの管理を各ユーザに委譲することができます。SnapCenter を使用すれば、データベース管理者やストレージ管理者は、さまざまなアプリケーションやデータベースのバックアップ、リストア、クローニングの処理を 1 つのツールで管理できます。

SnapCenter は、ネットアップのデータファブリック内のすべてのエンドポイントのデータを管理します。SnapCenterを使用して、オンプレミス環境間、オンプレミス環境とクラウド間、プライベートクラウド、ハイブリッドクラウド、パブリッククラウド間でデータをレプリケートできます。



== SnapCenter コンポーネント

SnapCenter には、SnapCenter サーバ、SnapCenter Plug-in Package for Windows、およびSnapCenter Plug-in Package for Linuxが含まれています。各パッケージには、さまざまなアプリケーションやインフラコンポーネント用の SnapCenter へのプラグインが含まれています。

image::amazon-fsx-image5.png[Amazon FSxイメージ5]



== SnapCenter SAP HANA Backup 解決策 の略

SnapCenter Backup 解決策 for SAP HANA には、次の領域があります。

* バックアップ処理、スケジュール設定、保持の管理
+
** ストレージベースのSnapshotコピーを使用したSAP HANAデータのバックアップ
** ストレージ・ベースのSnapshotコピーを使用した非データ・ボリューム・バックアップ（例：/hana/shared）
** ファイルベースのバックアップを使用したデータベースブロックの整合性チェック
** オフサイトのバックアップまたはディザスタリカバリロケーションへのレプリケーション


* 不要な SAP HANA バックアップカタログの削除
+
** HANAデータのバックアップ（Snapshotとファイルベース）
** HANAのログバックアップ


* リストア処理とリカバリ処理
+
** リストアとリカバリの自動化
** SAP HANA（MDC）システムのシングルテナントのリストア処理




データベースデータファイルのバックアップは、 SnapCenter と SAP HANA 向けプラグインを組み合わせて実行されます。このプラグインは、SAP HANAデータベースのバックアップ保存ポイントをトリガーして、プライマリストレージシステムで作成されたSnapshotコピーがSAP HANAデータベースの整合性のあるイメージに基づいて作成されるようにします。

SnapCenter では、SnapVault またはSnapMirror機能を使用して、整合性のあるデータベースイメージをオフサイトのバックアップまたはディザスタリカバリロケーションにレプリケートできます。通常は、プライマリストレージとオフサイトのバックアップストレージに異なる保持ポリシーが定義されます。SnapCenter はプライマリストレージでの保持を処理し、 ONTAP はオフサイトのバックアップストレージでの保持を処理します。

SnapCenter では、SAP HANA関連のすべてのリソースを完全にバックアップするために、ストレージベースのSnapshotコピーにSAP HANAプラグインを使用して、データ以外のすべてのボリュームをバックアップすることもできます。非データボリュームをデータベースデータバックアップとは別にスケジュール設定して、個別の保持ポリシーや保護ポリシーを有効にすることができます。

SAP では、ブロックの整合性チェックを実行するために、ストレージベースの Snapshot バックアップと週次ファイルベースのバックアップを組み合わせることを推奨しています。SnapCenter 内からブロック整合性チェックを実行できます。設定された保持ポリシーに基づいて、SnapCenter は、プライマリストレージでのデータファイルバックアップの削除、ログファイルのバックアップ、およびSAP HANAのバックアップカタログの管理を行います。

SnapCenter はプライマリストレージで保持を処理し、FSX for ONTAP はセカンダリバックアップの保持を管理します。

次の図は、SnapCenter のバックアップおよび保持の管理処理の概要を示しています。

image::amazon-fsx-image6.png[Amazon FSxイメージ6]

SAP HANA データベースのストレージベースの Snapshot バックアップを実行する場合、 SnapCenter は次のタスクを実行します。

. SAP HANAのバックアップ保存ポイントを作成し、永続性レイヤに整合性のあるイメージを作成します。
. データボリュームのストレージベースのSnapshotコピーを作成します。
. ストレージベースのSnapshotバックアップをSAP HANAバックアップカタログに登録します。
. SAP HANAのバックアップ保存ポイントを解放します。
. データ・ボリュームに対してSnapVault またはSnapMirrorの更新を実行します（設定されている場合）。
. 定義された保持ポリシーに基づいて、プライマリストレージのストレージSnapshotコピーを削除します。
. プライマリまたはオフサイトのバックアップストレージにバックアップが存在しなくなった場合は、SAP HANAのバックアップカタログのエントリを削除します。
. 保持ポリシーに基づいてバックアップが削除された場合、または手動で削除された場合、SnapCenter は、最も古いデータバックアップよりも古いすべてのログバックアップも削除します。ログバックアップは、ファイルシステムと SAP HANA のバックアップカタログから削除されます。




== 本ドキュメントの内容

このドキュメントでは、ONTAP 用FSXでシングルテナントを使用するSAP HANA MDCシングルホストシステムの最も一般的なSnapCenter 構成オプションについて説明します。その他の構成オプションも使用できます。また、場合によっては、複数ホストシステムの場合など、特定のSAP HANAシステムに必要な構成オプションもあります。その他の設定オプションに関する概要 の詳細については、を参照してください https://docs.netapp.com/us-en/netapp-solutions-sap/backup/saphana-br-scs-snapcenter-concepts-and-best-practices.html["SnapCenter の概念とベストプラクティス（netapp.com）"^]。

このドキュメントでは、Amazon Web Services（AWS）コンソールとFSX for ONTAP CLIを使用して、ストレージレイヤで必要な設定手順を実行します。また、NetApp Cloud Managerを使用してONTAP 向けのFSXを管理することもできますが、これは本ドキュメントの対象外です。ONTAP でのFSXに対するNetApp Cloud Managerの使用については、を参照してください https://docs.netapp.com/us-en/occm/concept_fsx_aws.html["Amazon FSX for ONTAP （netapp.com）の詳細"^]。



== データ保護戦略

次の図は、FSX for ONTAP 上のSAP HANAの一般的なバックアップアーキテクチャを示しています。HANAシステムは、AWSアベイラビリティゾーン1にあり、同じアベイラビリティゾーン内でONTAP ファイルシステム用のFSXを使用しています。Snapshotバックアップ処理は、HANAデータベースのデータと共有ボリュームに対して実行されます。3～5日間保持されるローカルSnapshotバックアップに加えて、バックアップは長期保存用にオフサイトのストレージにもレプリケートされます。オフサイトバックアップストレージは、別のAWSアベイラビリティゾーンに配置されたONTAP ファイルシステム用の2番目のFSXです。HANAデータと共有ボリュームのバックアップは、SnapVault を使用して2番目のONTAP ファイルシステムのFSXにレプリケートされ、2~3週間保持されます。

image::amazon-fsx-image7.png[Amazon FSxイメージ7]

SnapCenter を設定する前に、各種SAPシステムのRTOとRPOの要件に基づいてデータ保護戦略を定義する必要があります。

一般的なアプローチとしては、本番システム、開発システム、テストシステム、サンドボックスシステムなどのシステムタイプを定義します。通常、システムタイプが同じ SAP システムのデータ保護パラメータはすべて同じです。

次のパラメータを定義する必要があります。

* Snapshot バックアップを実行する頻度
* Snapshot コピーバックアップをプライマリストレージシステムに保存する期間
* ブロック整合性チェックはどのくらいの頻度で実行する必要がありますか。
* プライマリバックアップをオフサイトのバックアップサイトにレプリケートする必要があるか。
* バックアップをオフサイトのバックアップストレージに保管する期間


次の表に、本番、開発、テストの各システムタイプのデータ保護パラメータの例を示します。本番用システムでは、高いバックアップ頻度が定義されており、バックアップはオフサイトのバックアップサイトに 1 日に 1 回レプリケートされます。テスト用システムの要件は低く、バックアップのレプリケーションはありません。

|===
| パラメータ | 本番用システム | 開発システム | システムをテストする 


| バックアップ頻度 | 6 時間ごと | 6 時間ごと | 6 時間ごと 


| プライマリの保持 | 3 日 | 3 日 | 3 日 


| ブロック整合性チェック | 週に 1 回 | 週に 1 回 | いいえ 


| オフサイトのバックアップサイトへのレプリケーション | 1 日に 1 回 | 1 日に 1 回 | いいえ 


| オフサイトへのバックアップの保持 | 2 週間 | 2 週間 | 該当なし 
|===
次の表に、データ保護パラメータに設定する必要があるポリシーを示します。

|===
| パラメータ | ポリシーLocalSnapです | ポリシーLocalSnapAndSnapVault | ポリシーブロック整合性チェック 


| バックアップタイプ | Snapshot ベース | Snapshot ベース | ファイルベース 


| スケジュール頻度 | 毎時 | 毎日 | 毎週 


| プライマリの保持 | カウント = 12 | カウント = 3 | count = 1 


| SnapVault レプリケーション | いいえ | はい。 | 該当なし 
|===
LocalSnapshot ポリシーは ' 本番システム ' 開発システム ' およびテスト・システムに使用され '2 日間の保持期間を持つローカル Snapshot バックアップをカバーします

リソース保護設定では、スケジュールはシステムタイプごとに異なります。

* プロダクション：4時間ごとにスケジュールを設定します。
* 開発：4時間ごとにスケジュールを設定
* Test：4時間ごとにスケジュールを設定します。


「 LocalSnapAndSnapVault' 」ポリシーは、本番システムおよび開発システムで、オフサイトのバックアップストレージへの日次レプリケーションをカバーするために使用されます。

リソース保護構成では、スケジュールは本番環境と開発環境に対して定義されます。

* 本番：毎日スケジュールを設定します。
* 開発：毎日スケジュールを設定します。本番システムおよび開発システムでは、ファイルベースのバックアップを使用して、週単位のブロック整合性チェックをカバーするために「BlockIntegrityCheck」ポリシーを使用します。


リソース保護構成では、スケジュールは本番環境と開発環境に対して定義されます。

* プロダクション：毎週スケジュールを設定します。
* 開発：毎週スケジュールを設定します。


オフサイトのバックアップポリシーを使用する個々のSAP HANAデータベースに対して、ストレージレイヤで保護関係を設定する必要があります。保護関係は、レプリケートされるボリュームとバックアップの保持をオフサイトのバックアップストレージで定義します。

次の例では、本番用システムと開発用システムごとに、オフサイトのバックアップストレージに2週間の保持を定義します。

この例では、SAP HANAデータベースのリソースと非データボリュームのリソースの保護ポリシーと保持方法は異なります。



== ラボのセットアップ例

このあとのセクションでは、以下のラボ環境の設定例を使用しました。

HANAシステムPFX：

* シングルテナントのシングルホストMDCシステム
* HANA 2.0 SPS 6リビジョン60
* SLES for SAP 15SP3』を参照してください


SnapCenter ：

* バージョン4.6
* HANAデータベースホストに導入されたHANAとLinuxのプラグイン


ONTAP ファイルシステムのFSx：

* ONTAP ファイルシステム用のFSX 2（単一のStorage Virtual Machine（SVM））
* 異なるAWSアベイラビリティゾーンにあるONTAP システムの各FSX
* ONTAP ファイルシステム用の2番目のFSXにHANAデータボリュームがレプリケートされます


image::amazon-fsx-image8.png[Amazon FSxイメージ8]
