---
sidebar: sidebar 
permalink: backup/saphana-backup-anf-restore-and-recovery.html 
keywords: restore, recovery, workflow, studio, cockpit 
summary: このセクションでは、 HANA MDC のシングルホストシングルテナントシステムのリストアとリカバリのワークフローについて説明します。複数ホストシステムの違いについて説明します。 
---
= リストアとリカバリ
:hardbreaks:
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


link:saphana-backup-anf-file-based-backups-and-block-integrity-check.html["Previous ：ファイルベースのバックアップとブロックの整合性チェック。"]

次のセクションでは、 HANA MDC のシングルホストシングルテナントシステムのリストアとリカバリのワークフローについて説明します。複数ホストシステムの違いについて説明します。

以下の例では、手動リカバリを実行するツールとして SAP HANA Studio を使用しています。リカバリ処理には、 SAP HANA Cockpit または HANA の SQL ステートメントを使用することもできます。

SAP HANA Studio および SnapCenter サービスを使用して SAP HANA MDC のシングルテナントシステムをリストアおよびリカバリするには、次の手順を実行します。

. SAP HANA Studio でリストアとリカバリのプロセスを準備します。
+
.. システムデータベースのリカバリを選択し、 SAP HANA システムのシャットダウンを確認します。
.. リカバリタイプとログのバックアップ先を選択します。
+
データバックアップのリストが表示されます。

.. 該当するバックアップを選択し、外部バックアップ ID を確認します。


. HANA データボリュームをアンマウントします。
. SnapCenter サービスでリストアプロセスを実行します。
+
.. バックアップビューで、 SAP HANA Studio の外部バックアップの ID またはコメントフィールドに一致するバックアップを選択します。
.. リストア処理を開始するには、コンテキストメニューでリストアを選択します。


. HANA データボリュームをマウント
. SAP HANA Studio を使用して、システムデータベースのリカバリプロセスを実行します。
+
.. バックアップ・リストから [ 更新 ] をクリックし ' リカバリに使用できるバックアップを選択します（緑色のアイコンが表示されます）
.. リカバリ処理を開始します。
+
リカバリ処理が完了すると、システムデータベースが起動します。



. SAP HANA Studio を使用してテナントデータベースのリカバリプロセスを実行します。
+
.. [Recover Tenant Database] を選択して、リカバリするテナントを選択します。
.. リカバリタイプとログのバックアップ先を選択します。
+
データバックアップのリストが表示されます。データボリュームはすでにリストアされているため、テナントのバックアップには使用可能（緑）と表示されます。

.. バックアップを選択し、リカバリプロセスを開始します。リカバリプロセスが完了すると、テナントデータベースが自動的に起動します。




以下に、 HANA システム PR1 のリストア処理とリカバリ処理の手順について説明します。

. システムデータベースのリカバリを開始するには、 SAP HANA Studio で、 Backup and Recovery Recover System Database オプションに移動します。
+
image:saphana-backup-anf-image59.png["エラー：グラフィックイメージがありません"]

. リカバリタイプを選択して、 Next （次へ）をクリックします。
+
image:saphana-backup-anf-image60.png["エラー：グラフィックイメージがありません"]

. バックアップカタログの場所を指定し、 [ 次へ ] をクリックします。
+
image:saphana-backup-anf-image61.png["エラー：グラフィックイメージがありません"]

. HANA のバックアップカタログの内容に基づいて、使用可能なバックアップのリストが表示されます。必要なバックアップを選択し、次のスクリーンショットに示すように外部バックアップの ID をメモします。
+
image:saphana-backup-anf-image62.png["エラー：グラフィックイメージがありません"]

. すべてのデータボリュームをアンマウントします。
+
....
umount /hana/data/PR1/mnt00001
....
+

NOTE: SAP HANA マルチホストシステムの場合は、各ホストのすべてのデータボリュームをアンマウントする必要があります。

. SnapCenter サービス UI で、 SAP HANA システムビューのコンテキストメニューから View Backups を選択します。
. リストア処理を開始するには、バックアップビューで、 HANA Studio にも表示される最新のバックアップを選択し、コンテキストメニューからリストアを選択します。
+
image:saphana-backup-anf-image63.png["エラー：グラフィックイメージがありません"]

. 復元操作を確認するには、 [ はい ] 、 [ 復元 ] をクリックします。
+
image:saphana-backup-anf-image64.png["エラー：グラフィックイメージがありません"]

+
SnapCenter サービスのジョブログには、リストア処理の進捗状況が表示されます。

+
image:saphana-backup-anf-image65.png["エラー：グラフィックイメージがありません"]

. リストアプロセスが完了するまで待ちます。各データベースホストで、すべてのデータボリュームをマウントします。次の例では、データベースホスト上でボリュームを 1 つだけ再マウントする必要があります。
+
....
mount /hana/data/SP1/mnt00001
....
. 使用可能なバックアップのリストを更新するには、 SAP HANA Studio に移動して、更新をクリックします。SnapCenter サービスでリストアされたバックアップは、バックアップのリストに緑のアイコンで表示されます。バックアップを選択し、 Next （次へ）をクリックします。
+
image:saphana-backup-anf-image66.png["エラー：グラフィックイメージがありません"]

. ログバックアップの場所を指定します。次へをクリックします。
+
image:saphana-backup-anf-image67.png["エラー：グラフィックイメージがありません"]

. 必要に応じて、他の設定を選択します。［ デルタバックアップを使用 ］ が選択されていないことを確認します。次へをクリックします。
+
image:saphana-backup-anf-image68.png["エラー：グラフィックイメージがありません"]

. リカバリ設定を確認し、 [ 完了 ] をクリックします。
+
image:saphana-backup-anf-image69.png["エラー：グラフィックイメージがありません"]

+
リカバリプロセスが開始されます。システムデータベースのリカバリが完了するまで待ちます。

+
image:saphana-backup-anf-image70.png["エラー：グラフィックイメージがありません"]

. SAP HANA Studio で、システムデータベースのエントリを選択し、 Backup and Recovery Recover Tenant Database に移動します。
+
image:saphana-backup-anf-image71.png["エラー：グラフィックイメージがありません"]

. リカバリするテナントを選択し、 Next （次へ）をクリックします。
+
image:saphana-backup-anf-image72.png["エラー：グラフィックイメージがありません"]

. リカバリタイプを指定して、 Next （次へ）をクリックします。
+
image:saphana-backup-anf-image73.png["エラー：グラフィックイメージがありません"]

. バックアップカタログの場所を確認し、 Next （次へ）をクリックします。
+
image:saphana-backup-anf-image74.png["エラー：グラフィックイメージがありません"]

. テナントデータベースがオフラインであることを確認します。[OK] をクリックして続行します。
+
image:saphana-backup-anf-image75.png["エラー：グラフィックイメージがありません"]

+
システムデータベースのリカバリ前にデータボリュームのリストアが実行されたため、テナントバックアップをすぐに使用できます。

. 緑色でハイライトされたバックアップを選択し、次へをクリックします。
+
image:saphana-backup-anf-image76.png["エラー：グラフィックイメージがありません"]

. ログのバックアップ先を確認し、 Next （次へ）をクリックします。
+
image:saphana-backup-anf-image77.png["エラー：グラフィックイメージがありません"]

. 必要に応じて、他の設定を選択します。［ デルタバックアップを使用 ］ が選択されていないことを確認します。次へをクリックします。
+
image:saphana-backup-anf-image78.png["エラー：グラフィックイメージがありません"]

. [ 完了 ] をクリックして、リカバリ設定を確認し、テナントデータベースのリカバリプロセスを開始します。
+
image:saphana-backup-anf-image79.png["エラー：グラフィックイメージがありません"]

. リカバリが完了してテナントデータベースが起動するまで待ちます。
+
image:saphana-backup-anf-image80.png["エラー：グラフィックイメージがありません"]

+
SAP HANA システムは稼働中です。



複数のテナントを使用する SAP HANA MDC システムの場合は、テナントごとに手順 15~24 を繰り返す必要があります。

link:saphana-backup-anf-additional-information.html["次へ：追加情報の検索場所。"]
