---
sidebar: sidebar 
permalink: backup/hana-sc-vmware-smas-smas-config.html 
keywords: SAP HANA, VMware, SnapMirror active sync, SnapCenter, backup and recovery 
summary:  
---
= SnapMirrorのアクティブな同期設定
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
この記事では、このソリューションに必要な設定手順について説明します。



== 前提条件

ストレージクラスタと関連するSVMのピア関係が確立されている必要があります。

両方のストレージクラスタでONTAPメディエーターが使用可能で設定されている必要があります。

image:sc-saphana-vmware-smas-image10.png["説明している内容を示す図"]

image:sc-saphana-vmware-smas-image11.png["説明している内容を示す図"]



== ストレージレイアウトと整合グループの設定

ONTAPのドキュメントでは https://docs.netapp.com/us-en/ontap/snapmirror-active-sync/index.html#key-concepts["ONTAPでのSnapMirrorアクティブ同期の概要"]、SnapMirrorアクティブ同期を使用する整合グループの概念を次のように説明しています。

整合グループはFlexVolボリュームの集まりで、ビジネス継続性のために保護する必要があるアプリケーションワークロードの整合性を保証します。

整合性グループの目的は、複数のボリュームのSnapshotイメージを同時に作成して、ある時点における一連のボリュームのcrash-consistentコピーを作成することです。整合グループを使用すると、データセットのすべてのボリュームが休止され、正確に同じポイントインタイムにスナップされます。これにより、データセットをサポートするボリューム間でデータ整合性のあるリストアポイントが提供されます。これにより、整合グループは従属書き込み順序の整合性を維持します。ビジネス継続性のためにアプリケーションを保護する場合は、ソースとデスティネーションの整合グループの間にデータ保護関係を確立できるように、このアプリケーションに対応するボリュームグループを整合グループに追加する必要があります。ソース整合性とデスティネーション整合性には、同じ数とタイプのボリュームが含まれている必要があります。

HANAシステムのレプリケーションでは、整合性グループに、個 々 のHANAシステムで使用されるすべてのボリューム（データ、ログ、共有）が含まれている必要があります。整合グループに含めるボリュームは、同じSVMに格納する必要があります。オペレーティングシステムイメージは、独自の整合グループを持つ別のボリュームに格納できます。次の図は、2つのHANAシステムを使用した構成例を示しています。

image:sc-saphana-vmware-smas-image12.png["説明している内容を示す図"]



== イニシエータグループの構成

このラボのセットアップでは、SnapMirrorのアクティブな同期レプリケーションに使用する両方のストレージSVMを含むイニシエータグループを作成しました。後述するSnapMirrorのアクティブな同期設定では、イニシエータグループをレプリケーションの一部として定義します。

このプロキシミティ設定を使用して、どのESXホストがどのストレージクラスタに近いかを定義しました。この例では、A700はESX-1に近く、A800はESX-2に近くなっています。

image:sc-saphana-vmware-smas-image13.png["説明している内容を示す図"]

image:sc-saphana-vmware-smas-image14.png["説明している内容を示す図"]


NOTE: 統一されていないアクセス設定では、プライマリストレージクラスタ（A700）のイニシエータグループにESX-1ホストのイニシエータのみを含める必要があります。これは、ESX-2へのSAN接続がないためです。また、2つ目のストレージクラスタ（A800）に、ESX-2ホストのイニシエータのみを含む別のイニシエータグループを設定する必要があります。プロキシミティ構成とイニシエータグループのレプリケーションは必要ありません。



== ONTAP System Managerを使用した保護の設定

image:sc-saphana-vmware-smas-image15.png["説明している内容を示す図"]



=== 整合グループとイニシエータグループのレプリケーション

新しい整合グループを作成し、HANAシステムの3つのLUNをすべて整合グループに追加する必要があります。

[イニシエータグループのレプリケート]が有効になりました。その後、イミテータグループは、変更が行われた場所で独立して同期されたままになります。


NOTE: 異なるアクセス設定では、別のイニシエータグループを2つ目のストレージクラスタに設定する必要があるため、イニシエータグループをレプリケートしないでください。

image:sc-saphana-vmware-smas-image16.png["説明している内容を示す図"]

近接設定をクリックすると、イニシエータグループのセットアップで実行された設定を確認できます。

image:sc-saphana-vmware-smas-image17.png["説明している内容を示す図"]

デスティネーションストレージクラスタを設定し、「関係の初期化」を有効にする必要があります。



=== 同期

A700ストレージクラスタ（ソース）に新しい関係が表示されます。

image:sc-saphana-vmware-smas-image18.png["説明している内容を示す図"]

A800ストレージクラスタ（デスティネーション）で、新しい関係とレプリケーションのステータスが表示されます。

image:sc-saphana-vmware-smas-image19.png["説明している内容を示す図"]



== Infrastructureデータストア

HANAシステム、SnapCenter、vSphereプラグインのOSイメージが格納されるデータストアは、HANAデータベースデータストアの場合と同じ方法でレプリケートされます。



== プライマリサイト

SnapMirrorのアクティブな同期の動作は対称ですが、重要な例外が1つあります（プライマリサイトの設定）。

SnapMirrorアクティブ同期では、一方のサイトが「ソース」で、もう一方が「デスティネーション」と見なされます。これは一方向のレプリケーション関係を意味しますが、IO動作には適用されません。レプリケーションは双方向であり、対称であり、IO応答時間はミラーの両側で同じです。

レプリケーションリンクが失われた場合、ソースコピー上のLUNパスは引き続きデータを提供しますが、デスティネーションコピー上のLUNパスは、レプリケーションが再確立されてSnapMirrorが同期状態に戻るまで使用できなくなります。その後、パスでデータの提供が再開されます。

1つのクラスタをソースとして指定すると、レプリケーションリンクが失われた場合に、どのクラスタが読み取り/書き込みストレージシステムとして残っているかが制御されます。

プライマリサイトはSnapCenterによって検出され、バックアップ、リストア、クローニングの各処理に使用されます。


NOTE: ソースとデスティネーションはSVMまたはストレージクラスタに関連付けられていませんが、レプリケーション関係ごとに異なる場合があることに注意してください。

image:sc-saphana-vmware-smas-image20.png["説明している内容を示す図"]
