---
sidebar: sidebar 
permalink: bp/hana-aff-fc-architecture.html 
keywords: FCP, fibre channel, fiber channel, configuration, 
summary:  
---
= アーキテクチャ
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
SAP HANA ホストは、冗長 FCP インフラとマルチパスソフトウェアを使用してストレージコントローラに接続されます。スイッチまたはホストバスアダプタ（ HBA ）で障害が発生した場合に、耐障害性に優れた SAP HANA ホスト / ストレージ接続を実現するには、冗長 FCP スイッチインフラが必要です。すべての HANA ホストがストレージコントローラ上の必要な LUN にアクセスできるように、スイッチで適切なゾーニングを設定する必要があります。

AFF システム製品ファミリーのさまざまなモデルをストレージレイヤで混在させることができるため、拡張が必要になったり、パフォーマンスや容量のニーズが異なる場合があります。ストレージシステムに接続できる SAP HANA ホストの最大数は、 SAP HANA のパフォーマンス要件と、使用されているネットアップコントローラのモデルによって定義されます。必要なディスクシェルフの数は、 SAP HANA システムの容量とパフォーマンスの要件によってのみ決まります。

次の図は、 8 台の SAP HANA ホストをストレージ HA ペアに接続した構成例を示しています。

image:saphana_aff_fc_image2b.png["8台のSAP HANAホストをストレージHAペアに接続"]

このアーキテクチャは、次の 2 つの側面で拡張できます。

* 既存のストレージに SAP HANA ホストとストレージ容量を追加で接続することで、ストレージコントローラが現在の SAP HANA KPI を満たす十分なパフォーマンスを提供する場合
* 追加の SAP HANA ホスト用にストレージ容量を追加したストレージシステムを追加する


次の図は、追加の SAP HANA ホストをストレージコントローラに接続した場合の構成例を示しています。この例では、 16 台の SAP HANA ホストの容量とパフォーマンスの要件を満たすために、さらにディスクシェルフが必要です。合計スループット要件に応じて、ストレージコントローラへの FC 接続を追加する必要があります。

image:saphana_aff_fc_image3b.png["ストレージHAペアに接続された追加のSAP HANAホスト"]

次の図に示すように、導入した AFF システムとは関係なく、認定済みのストレージコントローラを追加することで、 SAP HANA 環境を拡張して希望するノード密度に合わせることもできます。

image:saphana_aff_fc_image4b.png["ストレエシHAヘアノツイカ"]



== SAP HANA のバックアップ

すべてのネットアップストレージコントローラに搭載された ONTAP ソフトウェアは、動作中にパフォーマンスに影響を与えることなく SAP HANA データベースをバックアップするための組み込みメカニズムを提供します。ストレージベースの NetApp Snapshot バックアップは、 SAP HANA の単一コンテナ、および単一のテナントや複数のテナントを使用する SAP HANA MDC システムで使用可能な、完全にサポートされた統合バックアップ解決策です。

ストレージベースの Snapshot バックアップは、 NetApp SnapCenter Plug-in for SAP HANA を使用して実装されます。これにより、 SAP HANA データベースに標準で搭載されているインターフェイスを使用して、整合性のあるストレージベースの Snapshot バックアップを作成できます。SnapCenter は、各 Snapshot バックアップを SAP HANA バックアップカタログに登録します。そのため、 SnapCenter で作成されたバックアップは、リストア処理とリカバリ処理用に直接選択できる SAP HANA Studio または Cockpit 内に表示できます。

NetApp SnapMirror テクノロジを使用すると、 1 つのストレージシステムで作成された Snapshot コピーを、 SnapCenter で制御されるセカンダリバックアップストレージシステムにレプリケートできます。その後、プライマリストレージ上のバックアップセットごと、およびセカンダリストレージシステム上のバックアップセットごとに、異なるバックアップ保持ポリシーを定義できます。SnapCenter Plug-in for SAP HANA は、不要なバックアップカタログの削除を含め、 Snapshot コピーベースのデータバックアップとログバックアップの保持を自動的に管理します。また、 SnapCenter Plug-in for SAP HANA では、ファイルベースのバックアップを実行することで、 SAP HANA データベースのブロック整合性チェックを実行できます。

次の図に示すように、 NFS マウントを使用して、データベースログをセカンダリストレージに直接バックアップできます。

image:saphana_asa_fc_image5a.png["SnapCenterの概要"]

ストレージベースの Snapshot バックアップは、従来のファイルベースのバックアップに比べて大きなメリットをもたらします。これには次のような利点がありますが、これらに限定されるわけではありません。

* 高速バックアップ（数分）
* ストレージレイヤでのリストア時間（数分）が大幅に短縮され、バックアップの頻度も高まり、 RTO が短縮されます
* バックアップとリカバリの処理中、 SAP HANA データベースのホスト、ネットワーク、またはストレージのパフォーマンスが低下することはありません
* ブロックの変更に基づいて、スペース効率と帯域幅効率に優れたセカンダリストレージへのレプリケーションを実行します


SAP HANAのバックアップとリカバリのソリューションの詳細については、を参照してくださいlink:../backup/hana-br-scs-overview.html["TR-4614 ：『 SAP HANA Backup and Recovery with SnapCenter 』"^]。



== SAP HANA ディザスタリカバリ

SAP HANA ディザスタリカバリは、 SAP HANA システムレプリケーションを使用してデータベースレイヤで実行するか、ストレージレプリケーションテクノロジを使用してストレージレイヤで実行できます。次のセクションでは、ストレージレプリケーションに基づくディザスタリカバリソリューションの概要について説明します。

SAP HANAディザスタリカバリソリューションの詳細については、を参照してくださいlink:../backup/hana-dr-sr-pdf-link.html["TR-4646 ：『 SAP HANA Disaster Recovery with Storage Replication 』"^]。



=== SnapMirror に基づくストレージレプリケーション

次の図は、ローカルDRデータセンターへの同期SnapMirror Active Syncと、リモートDRデータセンターへのデータ複製に非同期SnapMirrorを使用する3サイトのディザスタリカバリソリューションを示しています。SnapMirrorActive Syncにより、サイト全体の障害発生時でもビジネスサービスは継続して稼働し、セカンダリコピー（RPO=0、RTO=0）を使用してアプリケーションを透過的にフェイルオーバーできます。SnapMirrorActive Syncでは、フェイルオーバーを開始するために手動による介入やカスタムスクリプトは必要ありません。ONTAP 9.15.1以降では、SnapMirrorアクティブ同期で対称アクティブ/アクティブ機能がサポートされます。対称アクティブ/アクティブ：双方向同期レプリケーションにより、保護されたLUNの両方のコピーからの読み取りおよび書き込みI/O処理を有効にし、両方のLUNコピーがローカルでI/O処理を処理できるようにします。

詳細については、を参照してください https://docs.netapp.com/us-en/ontap/snapmirror-active-sync/index.html["ONTAPでのSnapMirrorアクティブ同期の概要"^]。

非同期 SnapMirror レプリケーションの RTO は、主に DR サイトで HANA データベースを起動し、データをメモリにロードするのに必要な時間によって決まります。1000Mbps のスループットでデータが読み取られることを前提とし、 1TB のデータをロードするには約 18 分かかります。

DR サイトのサーバは、通常運用時に開発 / テストシステムとして使用できます。災害が発生した場合は、開発 / テスト用システムをシャットダウンし、 DR 本番用サーバとして起動する必要があります。

どちらのレプリケーション方法でも、 RPO と RTO に影響を与えることなく DR ワークフローテストを実行できます。FlexClone ボリュームはストレージ上に作成され、 DR テストサーバに接続されます。

image:saphana_aff_fc_image6a.png["SnapMirrorソリューション"]



=== NetApp MetroCluster に基づくストレージレプリケーション

次の図は、解決策の概要を示しています。各サイトのストレージクラスタがローカルで高可用性を実現し、本番環境のワークロードに使用されます。各サイトのデータはもう一方のサイトに同期的にレプリケートされ、災害のフェイルオーバー時に使用できます。

image:saphana_aff_image7a.png["NetApp MetroCluster"]
